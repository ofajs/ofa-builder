<template page>
  <style>
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 300px;
      padding: 0 16px;
    }
    .hide {
      display: none !important;
    }
  </style>
  <l-m src="@pui/button/button.html"></l-m>

  <div class="container" class:hide="!canuse">
    <h1>ofa.js项目混淆器</h1>
    <p-button on:click="selectDir">选择你本地的 ofa.js 项目</p-button>
    <p>
      不用担心上传到服务器，因为这个应用没有服务端，是直接在浏览器上完成所有操作！！
    </p>
  </div>

  <div class="container" class:hide="!!canuse">
    <h2>
      你的浏览器暂时不支持该应用，请使用最新的 Chrome 浏览器来访问这个应用；
    </h2>
    <p>
      因为这个工具是通过 File Access API
      访问你本地文件夹进行混淆的，你当前的浏览器不支持这个API。
    </p>
  </div>
  <script>
    export default async ({ load }) => {
      load(`https://cdn.jsdelivr.net/npm/terser@5.27.0/dist/bundle.min.js`);
      const { open } = await load("https://cdn.jsdelivr.net/gh/kirakiray/NoneOS@1.3.1/core/fs/main.js");

      // const terser = await load(
      //   `https://cdn.jsdelivr.net/npm/terser@5.27.0/dist/bundle.min.js`
      // );

      // const result = await Terser.minify(
      //   "function add(aaaa, bbbbb) { return aaaa + bbbbb; }"
      // );
      // console.log(result);

      return {
        data: {
          canuse: !!window.showDirectoryPicker,
        },
        proto: {
          async selectDir() {
            const handle = await open();

            console.log("handle", handle);
          },
        },
        async ready() {

        },
      };
    };
  </script>
</template>
